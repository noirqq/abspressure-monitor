# –§—Ä–∞–≥–º–µ–Ω—Ç –¥–ª—è –≤–∞—à–µ–≥–æ automations.yaml

- id: 'telegram_current_pressure_static' # –ü—Ä–∏–º–µ—Ä ID, —Å–¥–µ–ª–∞–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–º
  alias: 'Telegram: –¢–µ–∫—É—â–µ–µ –¥–∞–≤–ª–µ–Ω–∏–µ (–∫–æ–º–∞–Ω–¥–∞ /pressure)'
  trigger:
    - platform: event
      event_type: telegram_command
      event_data:
        command: '/pressure'
  action:
    - service: notify.telegram # –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —ç—Ç–æ –≤–∞—à–µ –∏–º—è —Å–µ—Ä–≤–∏—Å–∞
      data:
        message: >
          üìä –¢–µ–∫—É—â–µ–µ –¥–∞–≤–ª–µ–Ω–∏–µ: {{ states("sensor.openweathermap_pressure") }}‚ÄØ–≥–ü–∞ 
          # –ó–ê–ú–ï–ù–ò–¢–ï sensor.openweathermap_pressure, –µ—Å–ª–∏ –≤–∞—à —Å–µ–Ω—Å–æ—Ä –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–Ω–∞—á–µ
        data: # –î–ª—è Markdown
          parse_mode: markdown

- id: 'telegram_pressure_trend_analysis_cmd' # –ü—Ä–∏–º–µ—Ä ID, —Å–¥–µ–ª–∞–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–º
  alias: 'Telegram: –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–∞ –¥–∞–≤–ª–µ–Ω–∏—è (–∫–æ–º–∞–Ω–¥–∞ /trend)'
  trigger:
    - platform: event
      event_type: telegram_command
      event_data:
        command: '/trend'
  action:
    - service: pyscript.get_pressure_analysis_for_telegram # –ò–º—è —Å–µ—Ä–≤–∏—Å–∞ –∏–∑ Pyscript
      data_template:
        hours_str: >
          {% if trigger.event.data.args %}
            {{ trigger.event.data.args[0] }}
          {% else %}
            {{ None }}
          {% endif %}
        chat_id: "{{ trigger.event.data.chat_id }}"
        user_id: "{{ trigger.event.data.user_id }}"
  mode: queued

- id: 'auto_pressure_alert_periodic_check' # –ü—Ä–∏–º–µ—Ä ID, —Å–¥–µ–ª–∞–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–º
  alias: '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–≤–ª–µ–Ω–∏—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π'
  trigger:
    - platform: time_pattern
      minutes: "/30" # –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
  action:
    - service: pyscript.check_pressure_for_auto_alert # –ò–º—è —Å–µ—Ä–≤–∏—Å–∞ –∏–∑ Pyscript
  mode: single